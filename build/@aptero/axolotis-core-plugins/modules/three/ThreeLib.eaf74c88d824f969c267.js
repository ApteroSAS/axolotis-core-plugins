/*!
 * 
 *   @aptero/axolotis-core-plugins v1.0.0
 *   https://github.com/ApteroSAS/axolotis-player
 *
 *   Copyright (c) Aptero (https://github.com/ApteroSAS/axolotis-player) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
"use strict";(self.webpackChunkaxolotis_core_plugins=self.webpackChunkaxolotis_core_plugins||[]).push([[422],{950:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  "Factory": function() { return /* binding */ Factory; },\n  "ThreeLib": function() { return /* binding */ ThreeLib; },\n  "asyncLoadThree": function() { return /* binding */ asyncLoadThree; },\n  "getGlobalRenderer": function() { return /* binding */ getGlobalRenderer; }\n});\n\n;// CONCATENATED MODULE: ./src/lib/modules/three/ThreeAssetsLoader.ts\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nclass AssetsLoader {\n  constructor() {\n    _defineProperty(this, "loaderCache", {});\n\n    _defineProperty(this, "assets", {});\n  }\n\n  async getLoader(loaderName, loaderLoader) {\n    if (!this.loaderCache[loaderName]) {\n      this.loaderCache[loaderName] = await loaderLoader();\n    }\n\n    return this.loaderCache[loaderName];\n  }\n\n}\nconst assetsLoader = new AssetsLoader();\n;// CONCATENATED MODULE: ./src/lib/modules/three/ThreeLib.ts\nfunction ThreeLib_defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n\nasync function asyncLoadThree() {\n  //this async import has the only usage of renamin any import to three (using webpack chunk)\n  const THREE = await __webpack_require__.e(/* import() | @aptero/axolotis-core-plugins/three */ 796).then(__webpack_require__.bind(__webpack_require__, 212));\n  return THREE;\n}\nasync function getGlobalRenderer() {\n  var _window$axolotis;\n\n  if (!((_window$axolotis = window.axolotis) !== null && _window$axolotis !== void 0 && _window$axolotis.renderer)) {\n    const THREE = await asyncLoadThree();\n    let renderer = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    renderer.toneMapping = THREE.ACESFilmicToneMapping;\n    renderer.toneMappingExposure = 1;\n    renderer.outputEncoding = THREE.sRGBEncoding;\n    renderer.setPixelRatio(window.devicePixelRatio);\n    document.body.appendChild(renderer.domElement);\n\n    if (!window.axolotis) {\n      window.axolotis = {};\n    }\n\n    window.axolotis.renderer = renderer;\n  }\n\n  return window.axolotis.renderer;\n}\nclass ThreeLib {\n  constructor(frameLoop, worldService, THREE) {\n    this.frameLoop = frameLoop;\n    this.worldService = worldService;\n    this.THREE = THREE;\n\n    ThreeLib_defineProperty(this, "renderer", void 0);\n\n    ThreeLib_defineProperty(this, "scene", void 0);\n\n    ThreeLib_defineProperty(this, "camera", void 0);\n\n    ThreeLib_defineProperty(this, "preRenderPass", []);\n  }\n\n  async init() {\n    this.scene = new this.THREE.Scene();\n    this.renderer = await getGlobalRenderer();\n    this.camera = new this.THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.001, 100000);\n    this.camera.position.z = 2;\n\n    const render = () => {\n      for (const prerender of this.preRenderPass) {\n        prerender();\n      } // FINAL PASS\n\n\n      this.renderer.render(this.scene, this.camera); // set things back to normal\n\n      this.renderer.autoClear = true;\n    };\n\n    const onWindowResize = () => {\n      this.camera.aspect = window.innerWidth / window.innerHeight;\n      this.camera.updateProjectionMatrix();\n      this.renderer.setSize(window.innerWidth, window.innerHeight);\n      render();\n    };\n\n    this.worldService.addOnWorldChangeCallback(() => {\n      window.removeEventListener("resize", onWindowResize);\n      this.frameLoop.removeLoop(ThreeLib.name);\n\n      if (this.worldService.isActiveWorld()) {\n        window.addEventListener("resize", onWindowResize, false);\n        this.frameLoop.addLoop(ThreeLib.name, render);\n      }\n    }, true);\n  }\n\n  async loadAssets(path) {\n    if (assetsLoader.assets[path]) {\n      return assetsLoader.assets[path];\n    }\n    /*\n    TODO createa a early start download of assets so that the GLB start downloading early in the waterfall\n    Not as simple as it seems may be doable using service worker\n    fetch(path);//start download of assets\n    var oReq = new XMLHttpRequest();\n    oReq.addEventListener("load", ()=>{});\n    oReq.open("GET", path);\n    oReq.send();\n    */\n\n\n    if (path.endsWith(".glb")) {\n      const loader = await assetsLoader.getLoader("GLTFLoader", async () => {\n        const module = await Promise.all(/* import() | @aptero/axolotis-core-plugins/three/examples/jsm/loaders/GLTFLoader */[__webpack_require__.e(796), __webpack_require__.e(404)]).then(__webpack_require__.bind(__webpack_require__, 217));\n        const gltfLoader = new module.GLTFLoader(); //const gltfLoader = new GLTFLoader(new this.THREE.LoadingManager());\n\n        return gltfLoader;\n      });\n      const result = await loader.loadAsync(path);\n      assetsLoader.assets[path] = result;\n    }\n\n    if (path.endsWith(".jpg")) {\n      const loader = await assetsLoader.getLoader("TextureLoader", async () => {\n        const texLoader = new this.THREE.TextureLoader();\n        return texLoader;\n      });\n      const result = await loader.loadAsync(path);\n      assetsLoader.assets[path] = result;\n    }\n\n    return assetsLoader.assets[path];\n  }\n\n  getType() {\n    return ThreeLib.name;\n  }\n\n}\nclass Factory {\n  constructor() {}\n\n  async createService(services) {\n    let frameLoop = await services.getService("@aptero/axolotis-player/modules/FrameLoop");\n    let worldService = await services.getService("@aptero/axolotis-player/modules/core/WorldService");\n    const threeLib = new ThreeLib(frameLoop, worldService, await asyncLoadThree());\n    await threeLib.init();\n    return threeLib;\n  }\n\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEMsU0FBUyxHQUFHLE1BQU1zQyxRQUFRLENBQUNDLFVBQVQsQ0FDcEIsMkNBRG9CLENBQXRCO0FBR0EsUUFBSXRDLFlBQVksR0FBRyxNQUFNcUMsUUFBUSxDQUFDQyxVQUFULENBQ3ZCLG1EQUR1QixDQUF6QjtBQUdBLFVBQU1DLFFBQVEsR0FBRyxJQUFJMUMsUUFBSixDQUNmRSxTQURlLEVBRWZDLFlBRmUsRUFHZixNQUFNekIsY0FBYyxFQUhMLENBQWpCO0FBS0EsVUFBTWdFLFFBQVEsQ0FBQ3RDLElBQVQsRUFBTjtBQUNBLFdBQU9zQyxRQUFQO0FBQ0Q7O0FBakJrRSIsInNvdXJjZXMiOlsid2VicGFjazovL2F4b2xvdGlzLWNvcmUtcGx1Z2lucy8uL3NyYy9saWIvbW9kdWxlcy90aHJlZS9UaHJlZUFzc2V0c0xvYWRlci50cz9jNzJiIiwid2VicGFjazovL2F4b2xvdGlzLWNvcmUtcGx1Z2lucy8uL3NyYy9saWIvbW9kdWxlcy90aHJlZS9UaHJlZUxpYi50cz9kNWUxIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBBc3NldHNMb2FkZXIge1xuICBsb2FkZXJDYWNoZSA9IHt9O1xuICBhc3NldHMgPSB7fTtcblxuICBhc3luYyBnZXRMb2FkZXIobG9hZGVyTmFtZTogc3RyaW5nLCBsb2FkZXJMb2FkZXI6ICgpID0+IHZvaWQpIHtcbiAgICBpZiAoIXRoaXMubG9hZGVyQ2FjaGVbbG9hZGVyTmFtZV0pIHtcbiAgICAgIHRoaXMubG9hZGVyQ2FjaGVbbG9hZGVyTmFtZV0gPSBhd2FpdCBsb2FkZXJMb2FkZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubG9hZGVyQ2FjaGVbbG9hZGVyTmFtZV07XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFzc2V0c0xvYWRlcjogQXNzZXRzTG9hZGVyID0gbmV3IEFzc2V0c0xvYWRlcigpO1xuIiwiaW1wb3J0IHsgYXNzZXRzTG9hZGVyIH0gZnJvbSBcIkByb290L2xpYi9tb2R1bGVzL3RocmVlL1RocmVlQXNzZXRzTG9hZGVyXCI7XG5pbXBvcnQgQ29tcG9uZW50IGZyb20gXCJAYXB0ZXJvL2F4b2xvdGlzLXBsYXllci9idWlsZC90eXBlcy9tb2R1bGVzL2NvcmUvZWNzL0NvbXBvbmVudFwiO1xuaW1wb3J0IHsgV2VicGFja0xhenlNb2R1bGUgfSBmcm9tIFwiQGFwdGVyby9heG9sb3Rpcy1wbGF5ZXIvYnVpbGQvdHlwZXMvbW9kdWxlcy9jb3JlL2xvYWRlci9XZWJwYWNrTG9hZGVyXCI7XG5pbXBvcnQge1xuICBGcmFtZUxvb3AsXG4gIExhenlTZXJ2aWNlcyxcbiAgV29ybGRTZXJ2aWNlLFxufSBmcm9tIFwiQGFwdGVyby9heG9sb3Rpcy1wbGF5ZXIvYnVpbGQvdHlwZXNcIjtcbmltcG9ydCB7IFNlcnZpY2UgfSBmcm9tIFwiQGFwdGVyby9heG9sb3Rpcy1wbGF5ZXIvYnVpbGQvdHlwZXMvbW9kdWxlcy9jb3JlL3NlcnZpY2UvTGF6eVNlcnZpY2VzXCI7XG5pbXBvcnQgeyBQZXJzcGVjdGl2ZUNhbWVyYSwgU2NlbmUsIFdlYkdMUmVuZGVyZXIgfSBmcm9tIFwidGhyZWVcIjtcblxuZGVjbGFyZSBsZXQgd2luZG93OiBhbnk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3luY0xvYWRUaHJlZSgpIHtcbiAgLy90aGlzIGFzeW5jIGltcG9ydCBoYXMgdGhlIG9ubHkgdXNhZ2Ugb2YgcmVuYW1pbiBhbnkgaW1wb3J0IHRvIHRocmVlICh1c2luZyB3ZWJwYWNrIGNodW5rKVxuICBjb25zdCBUSFJFRTogYW55ID0gYXdhaXQgaW1wb3J0KFxuICAgIC8qICB3ZWJwYWNrUHJlZmV0Y2g6IDAsICB3ZWJwYWNrTW9kZTogJ2xhenknLCAgd2VicGFja0NodW5rTmFtZTogXCJAYXB0ZXJvL2F4b2xvdGlzLWNvcmUtcGx1Z2lucy90aHJlZVwiICAqL1xuICAgIFwidGhyZWVcIlxuICApO1xuICByZXR1cm4gVEhSRUU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRHbG9iYWxSZW5kZXJlcigpIHtcbiAgaWYgKCF3aW5kb3cuYXhvbG90aXM/LnJlbmRlcmVyKSB7XG4gICAgY29uc3QgVEhSRUUgPSBhd2FpdCBhc3luY0xvYWRUaHJlZSgpO1xuICAgIGxldCByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzOiB0cnVlIH0pO1xuICAgIHJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG5cbiAgICByZW5kZXJlci50b25lTWFwcGluZyA9IFRIUkVFLkFDRVNGaWxtaWNUb25lTWFwcGluZztcbiAgICByZW5kZXJlci50b25lTWFwcGluZ0V4cG9zdXJlID0gMTtcbiAgICByZW5kZXJlci5vdXRwdXRFbmNvZGluZyA9IFRIUkVFLnNSR0JFbmNvZGluZztcbiAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgaWYgKCF3aW5kb3cuYXhvbG90aXMpIHtcbiAgICAgIHdpbmRvdy5heG9sb3RpcyA9IHt9O1xuICAgIH1cbiAgICB3aW5kb3cuYXhvbG90aXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgfVxuICByZXR1cm4gd2luZG93LmF4b2xvdGlzLnJlbmRlcmVyO1xufVxuXG5leHBvcnQgY2xhc3MgVGhyZWVMaWIgaW1wbGVtZW50cyBDb21wb25lbnQge1xuICByZW5kZXJlcjogV2ViR0xSZW5kZXJlcjtcbiAgc2NlbmU6IFNjZW5lO1xuICBjYW1lcmE6IFBlcnNwZWN0aXZlQ2FtZXJhO1xuICBwcmVSZW5kZXJQYXNzOiAoKCkgPT4gdm9pZClbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZnJhbWVMb29wOiBGcmFtZUxvb3AsXG4gICAgcHJpdmF0ZSB3b3JsZFNlcnZpY2U6IFdvcmxkU2VydmljZSxcbiAgICBwcml2YXRlIFRIUkVFXG4gICkge31cblxuICBhc3luYyBpbml0KCkge1xuICAgIHRoaXMuc2NlbmUgPSBuZXcgdGhpcy5USFJFRS5TY2VuZSgpO1xuXG4gICAgdGhpcy5yZW5kZXJlciA9IGF3YWl0IGdldEdsb2JhbFJlbmRlcmVyKCk7XG5cbiAgICB0aGlzLmNhbWVyYSA9IG5ldyB0aGlzLlRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxuICAgICAgNzUsXG4gICAgICB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgIDAuMDAxLFxuICAgICAgMTAwMDAwXG4gICAgKTtcbiAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi56ID0gMjtcblxuICAgIGNvbnN0IHJlbmRlciA9ICgpID0+IHtcbiAgICAgIGZvciAoY29uc3QgcHJlcmVuZGVyIG9mIHRoaXMucHJlUmVuZGVyUGFzcykge1xuICAgICAgICBwcmVyZW5kZXIoKTtcbiAgICAgIH1cbiAgICAgIC8vIEZJTkFMIFBBU1NcbiAgICAgIHRoaXMucmVuZGVyZXIucmVuZGVyKHRoaXMuc2NlbmUsIHRoaXMuY2FtZXJhKTtcbiAgICAgIC8vIHNldCB0aGluZ3MgYmFjayB0byBub3JtYWxcbiAgICAgIHRoaXMucmVuZGVyZXIuYXV0b0NsZWFyID0gdHJ1ZTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25XaW5kb3dSZXNpemUgPSAoKSA9PiB7XG4gICAgICB0aGlzLmNhbWVyYS5hc3BlY3QgPSB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTtcbiAgICAgIHJlbmRlcigpO1xuICAgIH07XG5cbiAgICB0aGlzLndvcmxkU2VydmljZS5hZGRPbldvcmxkQ2hhbmdlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgb25XaW5kb3dSZXNpemUpO1xuICAgICAgdGhpcy5mcmFtZUxvb3AucmVtb3ZlTG9vcChUaHJlZUxpYi5uYW1lKTtcbiAgICAgIGlmICh0aGlzLndvcmxkU2VydmljZS5pc0FjdGl2ZVdvcmxkKCkpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgb25XaW5kb3dSZXNpemUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5mcmFtZUxvb3AuYWRkTG9vcChUaHJlZUxpYi5uYW1lLCByZW5kZXIpO1xuICAgICAgfVxuICAgIH0sIHRydWUpO1xuICB9XG5cbiAgYXN5bmMgbG9hZEFzc2V0cyhwYXRoOiBzdHJpbmcpIHtcbiAgICBpZiAoYXNzZXRzTG9hZGVyLmFzc2V0c1twYXRoXSkge1xuICAgICAgcmV0dXJuIGFzc2V0c0xvYWRlci5hc3NldHNbcGF0aF07XG4gICAgfVxuICAgIC8qXG4gICAgVE9ETyBjcmVhdGVhIGEgZWFybHkgc3RhcnQgZG93bmxvYWQgb2YgYXNzZXRzIHNvIHRoYXQgdGhlIEdMQiBzdGFydCBkb3dubG9hZGluZyBlYXJseSBpbiB0aGUgd2F0ZXJmYWxsXG4gICAgTm90IGFzIHNpbXBsZSBhcyBpdCBzZWVtcyBtYXkgYmUgZG9hYmxlIHVzaW5nIHNlcnZpY2Ugd29ya2VyXG4gICAgZmV0Y2gocGF0aCk7Ly9zdGFydCBkb3dubG9hZCBvZiBhc3NldHNcbiAgICB2YXIgb1JlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIG9SZXEuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCk9Pnt9KTtcbiAgICBvUmVxLm9wZW4oXCJHRVRcIiwgcGF0aCk7XG4gICAgb1JlcS5zZW5kKCk7XG4gICAgKi9cbiAgICBpZiAocGF0aC5lbmRzV2l0aChcIi5nbGJcIikpIHtcbiAgICAgIGNvbnN0IGxvYWRlciA9IGF3YWl0IGFzc2V0c0xvYWRlci5nZXRMb2FkZXIoXCJHTFRGTG9hZGVyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9kdWxlOiBhbnkgPSBhd2FpdCBpbXBvcnQoXG4gICAgICAgICAgLyogIHdlYnBhY2tQcmVmZXRjaDogMCwgIHdlYnBhY2tNb2RlOiAnbGF6eScsICB3ZWJwYWNrQ2h1bmtOYW1lOiBcIkBhcHRlcm8vYXhvbG90aXMtY29yZS1wbHVnaW5zL3RocmVlL2V4YW1wbGVzL2pzbS9sb2FkZXJzL0dMVEZMb2FkZXJcIiAgKi9cbiAgICAgICAgICBcInRocmVlL2V4YW1wbGVzL2pzbS9sb2FkZXJzL0dMVEZMb2FkZXJcIlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBnbHRmTG9hZGVyID0gbmV3IG1vZHVsZS5HTFRGTG9hZGVyKCk7XG4gICAgICAgIC8vY29uc3QgZ2x0ZkxvYWRlciA9IG5ldyBHTFRGTG9hZGVyKG5ldyB0aGlzLlRIUkVFLkxvYWRpbmdNYW5hZ2VyKCkpO1xuICAgICAgICByZXR1cm4gZ2x0ZkxvYWRlcjtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9hZGVyLmxvYWRBc3luYyhwYXRoKTtcbiAgICAgIGFzc2V0c0xvYWRlci5hc3NldHNbcGF0aF0gPSByZXN1bHQ7XG4gICAgfVxuICAgIGlmIChwYXRoLmVuZHNXaXRoKFwiLmpwZ1wiKSkge1xuICAgICAgY29uc3QgbG9hZGVyID0gYXdhaXQgYXNzZXRzTG9hZGVyLmdldExvYWRlcihcIlRleHR1cmVMb2FkZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB0ZXhMb2FkZXIgPSBuZXcgdGhpcy5USFJFRS5UZXh0dXJlTG9hZGVyKCk7XG4gICAgICAgIHJldHVybiB0ZXhMb2FkZXI7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGxvYWRlci5sb2FkQXN5bmMocGF0aCk7XG4gICAgICBhc3NldHNMb2FkZXIuYXNzZXRzW3BhdGhdID0gcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gYXNzZXRzTG9hZGVyLmFzc2V0c1twYXRoXTtcbiAgfVxuXG4gIGdldFR5cGUoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gVGhyZWVMaWIubmFtZTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmFjdG9yeSBpbXBsZW1lbnRzIFdlYnBhY2tMYXp5TW9kdWxlLCBTZXJ2aWNlPFRocmVlTGliPiB7XG4gIGNvbnN0cnVjdG9yKCkge31cblxuICBhc3luYyBjcmVhdGVTZXJ2aWNlKHNlcnZpY2VzOiBMYXp5U2VydmljZXMpOiBQcm9taXNlPFRocmVlTGliPiB7XG4gICAgbGV0IGZyYW1lTG9vcCA9IGF3YWl0IHNlcnZpY2VzLmdldFNlcnZpY2U8RnJhbWVMb29wPihcbiAgICAgIFwiQGFwdGVyby9heG9sb3Rpcy1wbGF5ZXIvbW9kdWxlcy9GcmFtZUxvb3BcIlxuICAgICk7XG4gICAgbGV0IHdvcmxkU2VydmljZSA9IGF3YWl0IHNlcnZpY2VzLmdldFNlcnZpY2U8V29ybGRTZXJ2aWNlPihcbiAgICAgIFwiQGFwdGVyby9heG9sb3Rpcy1wbGF5ZXIvbW9kdWxlcy9jb3JlL1dvcmxkU2VydmljZVwiXG4gICAgKTtcbiAgICBjb25zdCB0aHJlZUxpYiA9IG5ldyBUaHJlZUxpYihcbiAgICAgIGZyYW1lTG9vcCxcbiAgICAgIHdvcmxkU2VydmljZSxcbiAgICAgIGF3YWl0IGFzeW5jTG9hZFRocmVlKClcbiAgICApO1xuICAgIGF3YWl0IHRocmVlTGliLmluaXQoKTtcbiAgICByZXR1cm4gdGhyZWVMaWI7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJBc3NldHNMb2FkZXIiLCJnZXRMb2FkZXIiLCJsb2FkZXJOYW1lIiwibG9hZGVyTG9hZGVyIiwibG9hZGVyQ2FjaGUiLCJhc3NldHNMb2FkZXIiLCJhc3luY0xvYWRUaHJlZSIsIlRIUkVFIiwiZ2V0R2xvYmFsUmVuZGVyZXIiLCJ3aW5kb3ciLCJheG9sb3RpcyIsInJlbmRlcmVyIiwiV2ViR0xSZW5kZXJlciIsImFudGlhbGlhcyIsInNldFNpemUiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJ0b25lTWFwcGluZyIsIkFDRVNGaWxtaWNUb25lTWFwcGluZyIsInRvbmVNYXBwaW5nRXhwb3N1cmUiLCJvdXRwdXRFbmNvZGluZyIsInNSR0JFbmNvZGluZyIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwiZG9jdW1lbnQiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJkb21FbGVtZW50IiwiVGhyZWVMaWIiLCJjb25zdHJ1Y3RvciIsImZyYW1lTG9vcCIsIndvcmxkU2VydmljZSIsImluaXQiLCJzY2VuZSIsIlNjZW5lIiwiY2FtZXJhIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJwb3NpdGlvbiIsInoiLCJyZW5kZXIiLCJwcmVyZW5kZXIiLCJwcmVSZW5kZXJQYXNzIiwiYXV0b0NsZWFyIiwib25XaW5kb3dSZXNpemUiLCJhc3BlY3QiLCJ1cGRhdGVQcm9qZWN0aW9uTWF0cml4IiwiYWRkT25Xb3JsZENoYW5nZUNhbGxiYWNrIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbW92ZUxvb3AiLCJuYW1lIiwiaXNBY3RpdmVXb3JsZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRMb29wIiwibG9hZEFzc2V0cyIsInBhdGgiLCJhc3NldHMiLCJlbmRzV2l0aCIsImxvYWRlciIsIm1vZHVsZSIsImdsdGZMb2FkZXIiLCJHTFRGTG9hZGVyIiwicmVzdWx0IiwibG9hZEFzeW5jIiwidGV4TG9hZGVyIiwiVGV4dHVyZUxvYWRlciIsImdldFR5cGUiLCJGYWN0b3J5IiwiY3JlYXRlU2VydmljZSIsInNlcnZpY2VzIiwiZ2V0U2VydmljZSIsInRocmVlTGliIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///950\n')}}]);