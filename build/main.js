/*!
 * 
 *   @aptero/axolotis-core-plugin v1.0.0
 *   https://github.com/ApteroSAS/axolotis-player
 *
 *   Copyright (c) Aptero (https://github.com/ApteroSAS/axolotis-player) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("axolotis-player",[],t):"object"==typeof exports?exports["axolotis-player"]=t():e["axolotis-player"]=t()}(self,(function(){return function(){var e={919:function(e){
/*!
 *
 *   @aptero/axolotis-player v1.0.0
 *   https://github.com/ApteroSAS/axolotis-player
 *
 *   Copyright (c) Aptero (https://github.com/ApteroSAS/axolotis-player) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
self,e.exports=function(){"use strict";var e,t,o={630:function(e,t,o){function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.r(t),o.d(t,{Factory:function(){return n},FrameLoop:function(){return i}});class n{async create(e){let t=await e.getService("@root/lib/modules/core/loader/CodeLoaderService"),o=new i;return t.awaitInitialLoading().then((()=>{o.startAnimationFrameLoop()})),o}}class i{constructor(){r(this,"loops",{}),r(this,"prevTime",0),r(this,"monitoringStart",(()=>{})),r(this,"monitoringEnd",(()=>{}))}startAnimationFrameLoop(){const e=t=>{this.monitoringStart(i.name);const o=t-this.prevTime;this.prevTime=t,requestAnimationFrame(e);for(const e in this.loops)this.monitoringStart(e),this.loops[e](o),this.monitoringEnd(e);this.monitoringEnd(i.name)};requestAnimationFrame(e)}setMonitoringCallback(e,t){this.monitoringStart=e,this.monitoringEnd=t}removeLoop(e){delete this.loops[e],this.monitoringStart(e),this.monitoringEnd(e)}addLoop(e,t){if(this.loops[e])throw new Error;this.loops[e]=t}getType(){return i.name}}},905:function(e,t,o){o.r(t),o.d(t,{Factory:function(){return n},WorldService:function(){return u},registerNewWorld:function(){return c}});var r=o(454);class n{constructor(){}async create(e){return new u(e)}}let i=-1,a=[],s=[],l=[];function c(e){a.push(e),i<0&&(i=0,window.axolotis.world=a[i],window.axolotis.activeWorld=i)}window&&(window.axolotis||(window.axolotis={}),window.axolotis.worlds=a,window.axolotis.activeWorld=i);class u{constructor(e){console.log("info");let t=null;for(const o of this.getWorlds())o.getFirstComponentByType(r.e.name)==e&&(t=o);if(!t)throw new Error;this.world=t,e.getService("@root/lib/modules/core/loader/CodeLoaderService").then((async e=>{e.awaitInitialLoading();for(const e of l)e()})),i>=0&&this.setActiveWorldByNumber(i)}getType(){return u.name}getWorlds(){return a}getActiveWorld(){return a[i]}isActiveWorld(){return this.world==this.getActiveWorld()}addOnWorldChangeCallback(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.push(e),t&&e()}addOnWorldAdded(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l.push(e),t&&e()}setActiveWorld(e){for(let t=0;t<this.getWorlds().length;t++)if(e==this.getWorlds()[t])return void this.setActiveWorldByNumber(t);throw new Error}setActiveWorldByNumber(e){if(i!=e){i=e,window&&window.axolotis&&(window.axolotis.activeWorld=i,window.axolotis.world=a[i]);for(const e of s)e()}}}},747:function(e,t,o){function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}t.Z=class{constructor(e){r(this,"components",[]),r(this,"waitingForComponent",{}),this.name=e}addComponent(e){if(this.components.push(e),this.waitingForComponent[e.getType()]){for(const t of this.waitingForComponent[e.getType()])t(e);delete this.waitingForComponent[e.getType()]}return e}removeAllComponents(){this.components.forEach((e=>{this.removeComponent(e)}))}removeComponent(e){return"destroy"in e&&e.destroy(),this.components=this.components.filter((t=>t!=e)),e}addComponents(e){e.forEach((e=>{this.addComponent(e)}))}getComponents(){return this.components}getComponentByType(e){let t=[];return this.components.forEach((o=>{o.getType()===e&&t.push(o)})),t}getComponentByTypeStartsWith(e){let t=[];return this.components.forEach((o=>{o.getType().startsWith(e)&&t.push(o)})),t}getFirstComponentByTypeStartsWith(e){return this.getComponentByTypeStartsWith(e)[0]}getFirstComponentByType(e){return this.getComponentByType(e)[0]}async getFirstComponentByTypeAsync(e){return this.getComponentByType(e)[0]?this.getComponentByType(e)[0]:(this.waitingForComponent[e]||(this.waitingForComponent[e]=[]),new Promise(((t,o)=>{this.waitingForComponent[e].push(t)})))}getType(){return this.name}}},378:function(e,t,o){o.d(t,{o:function(){return i}});var r=o(747),n=o(905);class i extends r.Z{constructor(){super("world"),(0,n.registerNewWorld)(this)}}},595:function(e,t,o){function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.d(t,{Ay:function(){return n},ev:function(){return a}});class n{constructor(){r(this,"loaderCache",{}),r(this,"assets",{})}async getLoader(e,t){return this.loaderCache[e]||(this.loaderCache[e]=await t()),this.loaderCache[e]}}const i=new n;async function a(e){if(i.assets[e])return i.assets[e];if(e.endsWith(".glb")){const t=await i.getLoader("GLTFLoader",(async()=>new((await Promise.all([o.e(212),o.e(217)]).then(o.bind(o,217))).GLTFLoader))),r=await t.loadAsync(e);i.assets[e]=r}if(e.endsWith(".jpg")){const t=await i.getLoader("TextureLoader",(async()=>new((await o.e(212).then(o.bind(o,212))).TextureLoader))),r=await t.loadAsync(e);i.assets[e]=r}return i.assets[e]}},928:function(e,t,o){o.d(t,{I:function(){return a}});var r=o(595),n=o(415),i=o(454);class a{constructor(){var e,t,o;o="",(t="roomUrl")in(e=this)?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,this.initialLoading=new Promise((e=>{this.initialLoadingResolver=e}))}cleanUpRoomUrl(e){return e.endsWith(".json")||(e+="/room.json"),e.replace("./",""),e.startsWith("http")||(e=window.location.origin+"/"+e),e}async loadRoomDefinitionFile(e){e=this.cleanUpRoomUrl(e),this.roomUrl=e;let t=await fetch(e);return await t.json()}async searchRoomDefinitionFile(){if(window.axolotis&&window.axolotis.room)return window.axolotis.room;for(const e of window.document.head.children)if("META"===e.tagName&&"axolotis:room"===e.name){let t=e.content;return this.loadRoomDefinitionFile(t)}throw new Error("No room definition found in meta axolotis:room")}getType(){return a.name}async awaitInitialLoading(){await this.initialLoading}async startLoading(e,t,o){let a=[];for(const o in t){const s=t[o];if("ecs-component-loader"===s.type&&s.module&&a.push((()=>new Promise((async(t,o)=>{s.name=s.name||"Factory";let r=await(0,n.o)(s.module,s.name),i=await r.create(e,s.config||{});if(!i.getType)throw new Error("Not a component : "+s.module+" "+i.constructor.name);e.addComponent(i),t(r)})))),"ecs-service-loader"===s.type&&s.module){let t=await e.getFirstComponentByType(i.e.name);await t.getService(s.module)}"assets-loader"===s.type&&s.url&&a.push((()=>(0,r.ev)(s.url)))}let s=function(e,t){let o=[],r=0;for(const n of e){const i=n();o.push(i),i.then((()=>{r++,t(r,e.length)}))}return Promise.all(o)}(a,o);return s.then((e=>{void 0!==this.initialLoadingResolver&&this.initialLoadingResolver(e)})),s.catch((e=>{console.error(e)})),s}}},415:function(e,t,o){async function r(e,t){if("@root/lib/modules/ammo/AmmoPhysics"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(887),o.e(534)]).then(o.bind(o,703))).Factory.name;if("@root/lib/modules/controller/cameraController/OrbitController"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(681)]).then(o.bind(o,681))).Factory.name;if("@root/lib/modules/controller/pathFindingPlayer/Input"===e&&"Factory"===t)return(await o.e(823).then(o.bind(o,823))).Factory.name;if("@root/lib/modules/controller/pathFindingPlayer/NavMeshPlayer"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(7)]).then(o.bind(o,7))).Factory.name;if("@root/lib/modules/controller/physicPlayerControl/Input"===e&&"Factory"===t)return(await o.e(226).then(o.bind(o,226))).Factory.name;if("@root/lib/modules/controller/physicPlayerControl/PlayerControls"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(887),o.e(238)]).then(o.bind(o,856))).Factory.name;if("@root/lib/modules/controller/PlayerService"===e&&"Factory"===t)return(await o.e(912).then(o.bind(o,912))).Factory.name;if("@root/lib/modules/core/WorldService"===e&&"Factory"===t)return(await Promise.resolve().then(o.bind(o,905))).Factory.name;if("@root/lib/modules/FrameLoop"===e&&"Factory"===t)return(await Promise.resolve().then(o.bind(o,630))).Factory.name;if("@root/lib/modules/portals/PortalLink"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(481)]).then(o.bind(o,481))).Factory.name;if("@root/lib/modules/portals/PortalsService"===e&&"Factory"===t)return(await o.e(237).then(o.bind(o,237))).Factory.name;if("@root/lib/modules/scenes/demo1/GLTFScene"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(217),o.e(106)]).then(o.bind(o,106))).Factory.name;if("@root/lib/modules/scenes/demo2/LevelSetup"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(887),o.e(66)]).then(o.bind(o,169))).Factory.name;if("@root/lib/modules/scenes/demo2/Sky2"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(298)]).then(o.bind(o,298))).Factory.name;if("@root/lib/modules/spoke/SpokeRoomLoader"===e&&"Factory"===t)return(await o.e(342).then(o.bind(o,342))).Factory.name;if("@root/lib/modules/three/ThreeLib"===e&&"Factory"===t)return(await Promise.all([o.e(212),o.e(781)]).then(o.bind(o,781))).Factory.name;throw new Error("Class Not Found")}async function n(e,t){const n=await async function(e){switch(e){case"@root/lib/modules/ammo/AmmoPhysics":return Promise.all([o.e(212),o.e(887),o.e(534)]).then(o.bind(o,703));case"@root/lib/modules/controller/cameraController/OrbitController":return Promise.all([o.e(212),o.e(681)]).then(o.bind(o,681));case"@root/lib/modules/controller/pathFindingPlayer/Input":return o.e(823).then(o.bind(o,823));case"@root/lib/modules/controller/pathFindingPlayer/NavMeshPlayer":return Promise.all([o.e(212),o.e(7)]).then(o.bind(o,7));case"@root/lib/modules/controller/physicPlayerControl/Input":return o.e(226).then(o.bind(o,226));case"@root/lib/modules/controller/physicPlayerControl/PlayerControls":return Promise.all([o.e(212),o.e(887),o.e(238)]).then(o.bind(o,856));case"@root/lib/modules/controller/PlayerService":return o.e(912).then(o.bind(o,912));case"@root/lib/modules/core/WorldService":return Promise.resolve().then(o.bind(o,905));case"@root/lib/modules/FrameLoop":return Promise.resolve().then(o.bind(o,630));case"@root/lib/modules/portals/PortalLink":return Promise.all([o.e(212),o.e(481)]).then(o.bind(o,481));case"@root/lib/modules/portals/PortalsService":return o.e(237).then(o.bind(o,237));case"@root/lib/modules/scenes/demo1/GLTFScene":return Promise.all([o.e(212),o.e(217),o.e(106)]).then(o.bind(o,106));case"@root/lib/modules/scenes/demo2/LevelSetup":return Promise.all([o.e(212),o.e(887),o.e(66)]).then(o.bind(o,169));case"@root/lib/modules/scenes/demo2/Sky2":return Promise.all([o.e(212),o.e(298)]).then(o.bind(o,298));case"@root/lib/modules/spoke/SpokeRoomLoader":return o.e(342).then(o.bind(o,342));case"@root/lib/modules/three/ThreeLib":return Promise.all([o.e(212),o.e(781)]).then(o.bind(o,781));default:throw new Error(e+" not found in module list - please run npm run pre-build")}}(e);for(const o in n){const i=n[o];if(i.prototype&&i.prototype.constructor.name===await r(e,t))return new i}throw new Error("invalid factory "+e+" - "+t)}o.d(t,{o:function(){return n}})},240:function(e,t,o){o.d(t,{i:function(){return n}});var r=o(415);class n{constructor(){var e,t,o;o={},(t="service")in(e=this)?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}toId(e,t){return e+":"+t}setService(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Factory";this.service[this.toId(e,o)]=Promise.resolve(t)}async getService(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Factory";if(this.service[this.toId(e,t)]){const o=await this.service[this.toId(e,t)];if(!o)throw new Error("error");return o}if(!this.service[this.toId(e,t)]){let o=(0,r.o)(e,t);this.service[this.toId(e,t)]=new Promise((async e=>{e(await(await o).create(this))}))}return await this.service[this.toId(e,t)]}}},454:function(e,t,o){o.d(t,{e:function(){return n}});var r=o(240);class n extends r.i{getType(){return n.name}}},147:function(e){e.exports={i8:"1.0.0"}}},r={};function n(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return o[e](i,i.exports,n),i.exports}n.m=o,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,o){return n.f[o](e,t),t}),[]))},n.u=function(e){return e+".js"},n.miniCssF=function(e){},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="axolotis-player:",n.l=function(o,r,i,a){if(e[o])e[o].push(r);else{var s,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+i){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=o),e[o]=[r];var m=function(t,r){s.onerror=s.onload=null,clearTimeout(h);var n=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((function(e){return e(r)})),t)return t(r)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=m.bind(null,s.onerror),s.onload=m.bind(null,s.onload),l&&document.head.appendChild(s)}},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){var e={826:0};n.f.j=function(t,o){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var i=new Promise((function(o,n){r=e[t]=[o,n]}));o.push(r[2]=i);var a=n.p+n.u(t),s=new Error;n.l(a,(function(o){if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,r[1](s)}}),"chunk-"+t,t)}};var t=function(t,o){var r,i,a=o[0],s=o[1],l=o[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);l&&l(n)}for(t&&t(o);c<a.length;c++)i=a[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},o=self.webpackChunkaxolotis_player=self.webpackChunkaxolotis_player||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var i={};return function(){n.r(i),n.d(i,{AssetsLoader:function(){return l.Ay},CodeLoaderComponent:function(){return e.I},Entity:function(){return s.Z},FrameLoop:function(){return d.FrameLoop},LazyServices:function(){return c.i},ServiceEntity:function(){return t.e},WorldEntity:function(){return o.o},WorldService:function(){return u.WorldService},init:function(){return a}});var e=n(928),t=n(454),o=n(378);const r=n(147).i8;function a(){let r=new t.e,n=new o.o;n.addComponent(r);let i=new e.I;r.setService("@root/lib/modules/core/loader/CodeLoaderService",i),i.searchRoomDefinitionFile().then((e=>{i.startLoading(n,e.entities,((e,t)=>{console.log("["+e+"/"+t+"]"),document.getElementById("progress").style.width="".concat(e/t*100,"%")})).then((()=>{console.log("loading complete"),document.getElementById("progresscontainer").className+="load"}))}))}console.log(r);var s=n(747),l=n(595),c=n(240),u=n(905),d=n(630)}(),i}()}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){"use strict";o.r(r);var e=o(919);(0,e.init)(),console.log("hello")}(),r}()}));
//# sourceMappingURL=main.js.map