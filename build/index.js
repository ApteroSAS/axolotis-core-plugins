/*!
 * 
 *   @aptero/axolotis-core-plugins v1.0.0
 *   https://github.com/ApteroSAS/axolotis-player
 *
 *   Copyright (c) Aptero (https://github.com/ApteroSAS/axolotis-player) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("axolotis-core-plugins",[],t):"object"==typeof exports?exports["axolotis-core-plugins"]=t():e["axolotis-core-plugins"]=t()}(self,(function(){return function(){var e,t,o,n={988:function(e){
/*!
 * 
 *   @aptero/axolotis-player v2.0.0
 *   https://github.com/ApteroSAS/axolotis-player
 *
 *   Copyright (c) Aptero (https://github.com/ApteroSAS/axolotis-player) and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
e.exports=function(){"use strict";var e={147:function(e){e.exports={i8:"2.0.0"}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,o),a.exports}o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return function(){o.r(n),o.d(n,{BUILD_VERSION:function(){return y},CODE_LOADER_MODULE_NAME:function(){return g},Entity:function(){return e},InitialComponentLoader:function(){return m},LazyEntity:function(){return S},LazyServices:function(){return d},Services:function(){return p},WorldEntity:function(){return r},createWorld:function(){return h},getGlobalStorage:function(){return i},initHtml:function(){return w},initHtmlFromUrl:function(){return v},instantiateLocalAsyncModule:function(){return c},registerLocalModule:function(){return s},registerLocalModuleList:function(){return l}});class e{constructor(){var e,t,o;o=[],(t="components")in(e=this)?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}addComponent(e){return this.components.push(e),e}removeAllComponents(){this.components.forEach((e=>{this.removeComponent(e)}))}removeComponent(e){return"destroy"in e&&e.destroy(),this.components=this.components.filter((t=>t!=e)),e}addComponents(e){e.forEach((e=>{this.addComponent(e)}))}getComponents(){return this.components}getComponentByType(e){let t=[];return this.components.forEach((o=>{o.getType()===e&&t.push(o)})),t}getComponentByTypeStartsWith(e){let t=[];return this.components.forEach((o=>{o.getType().startsWith(e)&&t.push(o)})),t}getFirstComponentByTypeStartsWith(e){return this.getComponentByTypeStartsWith(e)[0]}getFirstComponentByType(e){return this.getComponentByType(e)[0]}getType(){return e.name}}var t=e;class r extends t{constructor(){super()}getType(){return r.name}}var a=null;function i(e){return"undefined"!=typeof window&&(window.axolotis||(window.axolotis={})),a||"undefined"==typeof window||(a=window.axolotis),a||(a={}),a[e]||(a[e]={}),a[e]}function s(e,t,o){if(o||(o=i("localModules")),o[e])throw new Error("Module already defined");o[e]=t}function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;o||(o=i("localModules")),t&&console.log("imported module :",e),Object.assign(o,e)}async function c(e,t){const o=await t[e](),n=o.module;for(const e in n){const t=n[e];if(t.prototype&&t.prototype.constructor.name===o.classname)return new t}throw new Error("invalid factory "+e+" - "+o.classname)}async function u(e,t){let o=null;if(!t||!t[e])throw e.startsWith("http")?new Error("remote modules not implemented yet"):(console.log("local module installed:",t),new Error("unknown module - please register it - "+e));return o=await c(e,t),o}class d{constructor(e){var t,o,n;this.world=e,n={},(o="service")in(t=this)?Object.defineProperty(t,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[o]=n}getWorld(){return this.world}setService(e,t){this.service[e]=Promise.resolve(t)}async getService(e){if(this.service[e]){const t=await this.service[e];if(!t)throw new Error("error");return t}if(!this.service[e]){let t=u(e,(await this.service[g]).getModuleStorage());this.service[e]=new Promise((async e=>{e(await(await t).createService(this))}))}return await this.service[e]}}class p extends d{getType(){return p.name}}function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class m{constructor(){f(this,"initialLoading",void 0),f(this,"initialLoadingResolver",void 0),f(this,"moduleStorage",void 0),this.initialLoading=new Promise((e=>{this.initialLoadingResolver=e}))}getType(){return m.name}getModuleStorage(){return this.moduleStorage}async awaitInitialLoading(){await this.initialLoading}async startLoading(e,t,o,n){if(this.moduleStorage=n,"2.0"!==t.version)throw new Error("unsupported");let r=[];for(const o of t.entities)for(const t of o.components){let o=t.config;r.push((()=>new Promise((async(r,a)=>{const i=await u(t.module,n);let s=await i.createComponent(e,o||{});if(!s.getType)throw new Error("Not a component : "+t.module+" "+s.constructor.name);e.addComponent(s),r(i)}))))}let a=function(e,t){let o=[],n=0;for(const r of e){const a=r();o.push(a),a.then((()=>{n++,t(n,e.length)}))}return Promise.all(o)}(r,o);return a.then((e=>{void 0!==this.initialLoadingResolver&&this.initialLoadingResolver(e)})),a.catch((e=>{console.error(e)})),a}}const g="@aptero/axolotis-player/core/loader/InitialComponentLoader";async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{version:"2.0",entities:[]},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},o=arguments.length>2?arguments[2]:void 0;o||(o=i("localModules"));let n=new r,a=new p(n);n.addComponent(a);let s=new m;return a.setService(g,s),await s.startLoading(n,e,t,o),n}const y=o(147).i8;console.log("Axolotis-player version :"+y);const b=e=>{"complete"===document.readyState&&document.body?e():window.addEventListener("DOMContentLoaded",e)};async function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.onProgress||(t.onProgress=(t,o)=>{console.log("["+e+"] : ["+t+"/"+o+"]")}),t.onLoaded||(t.onLoaded=()=>{console.log("["+e+"] : loading complete")});const o=await fetch(e),n=await o.text();let r=(new DOMParser).parseFromString(n,"text/html").body.getElementsByTagName("ax-scene");if(!r||r&&0==r.length)return console.warn("Axolotis scene not found (no tag ax-scene)"),void t.onLoaded();console.log(r);const a=await h(x(r),t.onProgress);return t.onLoaded(),a}function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.onProgress||(e.onProgress=(e,t)=>{console.log("["+e+"/"+t+"]")}),e.onLoaded||(e.onLoaded=()=>{console.log("loading complete")}),b((()=>{let t=window.document.body.getElementsByTagName("ax-scene");if(!t||t&&0==t.length)return console.warn("Axolotis scene not found (no tag ax-scene)"),void e.onLoaded();console.log(t),h(x(t),e.onProgress).then(e.onLoaded)}))}function x(e){let t=e[0];const o={version:"2.0",entities:[]};for(const e of t.getElementsByTagName("ax-entity")){let t={components:[]};for(const o of e.getElementsByTagName("ax-component")){let e=JSON.stringify({});o.getAttribute("config")&&(e=o.getAttribute("config").replace(/(['"])?([a-z0-9A-Z_]+)(['"])?:/g,'"$2": '));let n={module:o.getAttribute("module"),config:JSON.parse(e)};t.components.push(n)}o.entities.push(t)}return o}class S extends t{constructor(e){super(),this.world=e}async addComponentAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.world.getFirstComponentByType(p.name),n=u(e,(await o.getService(g)).getModuleStorage());return await(await n).createComponent(this.world,t)}getType(){return S.name}}}(),n}()}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e].call(o.exports,o,o.exports,a),o.exports}a.m=n,a.F={},a.E=function(e){Object.keys(a.F).map((function(t){a.F[t](e)}))},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,o){return a.f[o](e,t),t}),[]))},a.u=function(e){return{289:"@aptero/axolotis-core-plugins/portals/PortalLink",315:"@aptero/axolotis-core-plugins/debug/PerformanceRStats",320:"@aptero/axolotis-core-plugins/worlds/WorldService",326:"@aptero/axolotis-core-plugins/controller/PlayerService",391:"@aptero/axolotis-core-plugins/spoke/SpokeRoomLoader",404:"@aptero/axolotis-core-plugins/three/examples/jsm/loaders/GLTFLoader",452:"@aptero/axolotis-core-plugins/three/ThreeLib",496:"@aptero/axolotis-core-plugins/frame/FrameLoop",660:"@aptero/axolotis-core-plugins/portals/PortalsService",701:"@aptero/axolotis-core-plugins/sky/Sky",718:"@aptero/axolotis-core-plugins/controller/pathFindingPlayer/NavMeshPlayer",741:"@aptero/axolotis-core-plugins/debug/DebugBtn",761:"@aptero/axolotis-core-plugins/controller/pathFindingPlayer/Input",796:"@aptero/axolotis-core-plugins/three",887:"@aptero/axolotis-core-plugins/controller/cameraController/OrbitController",925:"@aptero/axolotis-core-plugins/debug/PerformanceStats"}[e]+"."+{289:"2eeb38911da5d18b7c70",315:"758dfa1312d31ccc592e",320:"3b586062c6b9827a7a58",326:"71254a1ba99bdef94ded",391:"6a7a673e9c269e6f13dd",404:"bf3d2726582957f0e184",452:"4d864e04e506ca660ae5",496:"d7057b8bfae6e1eaec8d",660:"67f5cd4be82fa68a5ec4",701:"67ec3b717986c560697b",718:"712bfab68a446959eb99",741:"65b81f3a3563249aea0f",761:"dfaa3bfe091a278bff6c",796:"88ae5979a82a2ac6f77a",887:"24f88f728e9cf332ef73",925:"10d635fc00a407bbdba1"}[e]+".js"},a.miniCssF=function(e){},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="axolotis-core-plugins:",a.l=function(o,n,r,i){if(e[o])e[o].push(n);else{var s,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+r){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",t+r),s.src=o),e[o]=[n];var p=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var r=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e}(),function(){var e={826:0};a.f.j=function(t,o){var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var r=new Promise((function(o,r){n=e[t]=[o,r]}));o.push(n[2]=r);var i=a.p+a.u(t),s=new Error;a.l(i,(function(o){if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,n[1](s)}}),"chunk-"+t,t)}},a.F.j=function(t){if(!a.o(e,t)||void 0===e[t]){e[t]=null;var o=document.createElement("link");a.nc&&o.setAttribute("nonce",a.nc),o.rel="prefetch",o.as="script",o.href=a.p+a.u(t),document.head.appendChild(o)}};var t=function(t,o){var n,r,i=o[0],s=o[1],l=o[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(n in s)a.o(s,n)&&(a.m[n]=s[n]);if(l)l(a)}for(t&&t(o);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0},o=self.webpackChunkaxolotis_core_plugins=self.webpackChunkaxolotis_core_plugins||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}(),o={452:[796,404]},a.f.prefetch=function(e,t){Promise.all(t).then((function(){var t=o[e];Array.isArray(t)&&t.map(a.E)}))};var i={};return function(){"use strict";a.r(i),a.d(i,{load:function(){return t}});var e=a(988);function t(){const t={"@aptero/axolotis-core-plugins/controller/cameraController/OrbitController":async()=>{const e=await Promise.all([a.e(796),a.e(887)]).then(a.bind(a,681));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/controller/pathFindingPlayer/Input":async()=>{const e=await a.e(761).then(a.bind(a,823));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/controller/pathFindingPlayer/NavMeshPlayer":async()=>{const e=await Promise.all([a.e(796),a.e(718)]).then(a.bind(a,7));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/controller/PlayerService":async()=>{const e=await a.e(326).then(a.bind(a,912));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/debug/DebugBtn":async()=>{const e=await a.e(741).then(a.bind(a,551));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/debug/PerformanceRStats":async()=>{const e=await a.e(315).then(a.bind(a,94));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/debug/PerformanceStats":async()=>{const e=await a.e(925).then(a.bind(a,490));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/frame/FrameLoop":async()=>{const e=await a.e(496).then(a.bind(a,377));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/three/ThreeLib":async()=>{const e=await a.e(452).then(a.bind(a,950));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/portals/PortalsService":async()=>{const e=await a.e(660).then(a.bind(a,237));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/portals/PortalLink":async()=>{const e=await Promise.all([a.e(796),a.e(289)]).then(a.bind(a,481));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/sky/Sky":async()=>{const e=await Promise.all([a.e(796),a.e(701)]).then(a.bind(a,724));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/spoke/SpokeRoomLoader":async()=>{const e=await a.e(391).then(a.bind(a,431));return{module:e,classname:e.Factory.name}},"@aptero/axolotis-core-plugins/worlds/WorldService":async()=>{const e=await a.e(320).then(a.bind(a,787));return{module:e,classname:e.Factory.name}}};(0,e.registerLocalModuleList)(t)}t()}(),i}()}));
//# sourceMappingURL=index.js.map